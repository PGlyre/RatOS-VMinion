#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
##
#[include PGe-Klipper/all_fan.cfg]
#[include PGe-Klipper/BTT_mini12864_v2.0.cfg]
#[include PGe-Klipper/Chamber_Temp.cfg]
[include PGe-Klipper/Filament_Sensor.cfg]
#[include PGe-Klipper/FLY_buffer.cfg]
#[include PGe-Klipper/Neopixel.cfg]
[include PGe-Klipper/part-cooling.cfg]
#[include PGe-Klipper/SFS_V2.cfg]
[include PGe-Klipper/Spoolman.cfg]
###
[include shell_command.cfg]
#[include timelapse.cfg]
###
#[include PGe-Klipper/xxx]
#[include PGe-Klipper/xxx]
#[include PGe-Klipper/xxx]

#############################################################################################################
### LED Control
#############################################################################################################
[neopixel led_z-axis]
pin: PE4
chain_count: 14
color_order: GRBW
initial_RED: 0.8 #0.8
initial_GREEN: 0.8 #0.8
initial_BLUE: 0.8 #0.8
initial_WHITE: 0.8 #0.8

#[neopixel LEDlight]
#pin: PE4                     # signal interface
#chain_count: 26              # Number of lamp beads
#color_order: GRB             # colour sequence
#initial_RED: 0.2             # Initial red brightness
#initial_GREEN: 0.2           # Initial green brightness
#initial_BLUE: 0.2            # Initial blue brightness

#[neopixel shroud]
#pin: PA1
#chain_count: 1
#color_order: GRB


#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 200
variable_macro_travel_accel: 3000

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering 
### input shaper configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The X axis motor moves the print head left and right.
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: !x_dir_pin       # Remove ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 180
position_endstop: 0

#---------------------------------------------------- Y -----------------------------------------------------
# The Y axis motor moves the print bed forward and backward.
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin       # Remove ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 180
position_endstop: 0

#---------------------------------------------------- Z -----------------------------------------------------
# The Z axis motor moves the print head up and down.
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4      # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 180

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for your toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: e_dir_pin       # Remove ! in front of pin name to reverse the direction of extruder
rotation_distance: 5.57   # Bondtech LGX Lite default
#pressure_advance: 0.05   # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
control: pid
pid_kp: 21.673
pid_ki: 1.338
pid_kd: 87.776

#############################################################################################################
### FANS
#############################################################################################################
# Part cooling fan
#[fan]
# 4-pin fan connected to the controller board
#pin: PA8
#cycle_time:  0.00004

# Hotend cooling fan
#[heater_fan toolhead_cooling_fan]
#heater: extruder
# 2-pin fan connected to the controller board
#pin: PE5

# Controller cooling fan
#[controller_fan controller_fan]
# 2-pin fan connected to the controller board
#pin: PD12

#[temperature_fan pi]
## Electronics fan PWM
#pin: PD15
#max_power: 0.60
#control: watermark
#max_delta: 5.0
#sensor_type: temperature_host
#min_temp: 10.0
#max_temp: 80.0
#target_temp: 50.0
#shutdown_speed: 0.0

#[temperature_sensor chamber_temp]
#sensor_type: Generic 3950
#sensor_pin: PF5
#min_temp: 0
#max_temp: 75

#############################################################################################################

[heater_bed]
control: pid
pid_kp: 68.203
pid_ki: 2.842
pid_kd: 409.216

[exclude_object]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

# Probe configuration
[probe]
#z_offset: 0.0 # Will be commented out after a successful PROBE_CALIBRATE and SAVE_CONFIG
pin: ^probe_pin# For NPN NC probes such as the Super Pinda / Vinda / SupCR / Decoprobe probes.
#pin: ^!probe_pin # NPN NO (refer to the specs of your probe)
#pin: probe_pin # PNP NO (refer to the specs of your probe)
#pin: !probe_pin # PNP NC (refer to the specs of your probe)

# REMEMBER TO TUNE SENSORLESS HOMING BEFORE ATTEMPTING TO PRINT!
# You'll find instructions in the generated sensorless-homing-*.cfg file(s),
# where you should keep your sensorless homing settings.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*#
#*# [heater_bed]
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.024687, -0.036250, -0.147813
#*# 	0.002500, -0.085938, -0.236875
#*# 	-0.068125, -0.178438, -0.332813
#*# x_count = 3
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 37.1858
#*# max_x = 142.8058
#*# min_y = 37.1858
#*# max_y = 142.8058
#*#
#*# [probe]
#*# z_offset = 1.100
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 77.0
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 41.6
#*#
#*# [bed_mesh Ratos]
#*# version = 1
#*# points =
#*# 	0.025000, 0.026875, 0.007812, -0.051875, -0.113750
#*# 	0.034687, 0.000625, -0.036250, -0.110625, -0.181875
#*# 	0.024062, -0.015625, -0.069688, -0.136563, -0.239063
#*# 	-0.000000, -0.053438, -0.120313, -0.202813, -0.299063
#*# 	-0.054375, -0.131875, -0.192188, -0.284375, -0.383750
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 150.0
#*# min_y = 15.0
#*# max_y = 160.0
